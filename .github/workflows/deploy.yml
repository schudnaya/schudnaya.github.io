name: Deploy MkDocs to GitHub Pages

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–µ—Ç–æ–∫
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
          
      - name: Install dependencies
        run: |
          pip install mkdocs
          # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–∞—à—É —Ç–µ–º—É bootstrap386
          # –ï—Å–ª–∏ —Ç–µ–º–∞ –Ω–∞ PyPI:
          pip install mkdocs-bootstrap386
          
      - name: Build site
        run: mkdocs build
        
      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
      - name: Deploy to gh-pages branch
        run: |
          # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
          cd ${{ github.workspace }}
          
          # –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–µ—Ç–∫—É gh-pages
          if git show-ref --quiet refs/heads/gh-pages; then
            git checkout gh-pages
            git pull origin gh-pages
          else
            git checkout --orphan gh-pages
          fi
          
          # –£–¥–∞–ª—è–µ–º –≤—Å—ë, –∫—Ä–æ–º–µ .git
          git rm -rf . || true
          
          # –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–π —Å–∞–π—Ç
          cp -r ../site/* . || true
          
          # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã
          git add -A
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if git diff-index --quiet HEAD --; then
            echo "No changes to deploy"
          else
            # –ö–æ–º–º–∏—Ç–∏–º –∏ –ø—É—à–∏–º
            git commit -m "üöÄ Deploy MkDocs site - $(date '+%Y-%m-%d %H:%M:%S')
            
            Triggered by: ${{ github.event.head_commit.message || 'Manual deploy' }}
            Commit: ${{ github.sha }}
            Workflow: ${{ github.run_id }}"
            
            git push origin gh-pages --force
            echo "‚úÖ Successfully deployed to gh-pages branch!"
          fi
          
          # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∏—Å—Ö–æ–¥–Ω—É—é –≤–µ—Ç–∫—É
          git checkout ${{ github.ref_name }}
